<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Air Quality Realtime Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f9fa;
      color: #333;
      text-align: center;
      padding: 20px;
    }
    h1 {
      color: #007BFF;
    }
    #timestamp {
      margin: 10px 0 20px 0;
      color: gray;
      font-size: 0.9em;
    }
    table {
      margin: 0 auto;
      border-collapse: collapse;
      width: 70%;
    }
    th, td {
      padding: 12px;
      border: 1px solid #ccc;
    }
    th {
      background-color: #007BFF;
      color: white;
      text-align: left;
    }
    td:nth-child(2) {
      text-align: center;
    }
    tr:nth-child(even) {
      background-color: #f2f2f2;
    }
  </style>
</head>
<body>

  <h1>ðŸŒ± Air Quality Realtime Dashboard</h1>
  <div id="timestamp">Last Update: -</div>

  <table id="data-table">
    <thead>
      <tr>
        <th>Parameter</th>
        <th>Value</th>
      </tr>
    </thead>
    <tbody>
      <!-- Data rows will be added here -->
    </tbody>
  </table>

  <script>
    const unitMap = {
      CO2: 'ppm',
      Oxygen: '%',
      PM1_0_Standard: 'Âµg/mÂ³',
      PM2_5_Standard: 'Âµg/mÂ³',
      PM10_Standard: 'Âµg/mÂ³',
      PM1_0_env: 'Âµg/mÂ³',
      PM2_5_env: 'Âµg/mÂ³',
      PM10_env: 'Âµg/mÂ³',
      VOC: 'ppb',
      Pressure: 'Pa',
      Particles_0_3um: 'counts',
      Particles_0_5um: 'counts',
      Particles_1_0um: 'counts',
      Particles_2_5um: 'counts',
      Particles_5_0um: 'counts',
      Particles_10um: 'counts'
    };

    const nameMap = {
      CO2: 'COâ‚‚',
      Oxygen: 'Oâ‚‚',
      PM1_0_Standard: 'PM1.0 Std',
      PM2_5_Standard: 'PM2.5 Std',
      PM10_Standard: 'PM10 Std',
      PM1_0_env: 'PM1.0 Env',
      PM2_5_env: 'PM2.5 Env',
      PM10_env: 'PM10 Env',
      VOC: 'VOC',
      Pressure: 'Pressure',
      Particles_0_3um: 'Particles â‰¥0.3Âµm',
      Particles_0_5um: 'Particles â‰¥0.5Âµm',
      Particles_1_0um: 'Particles â‰¥1.0Âµm',
      Particles_2_5um: 'Particles â‰¥2.5Âµm',
      Particles_5_0um: 'Particles â‰¥5.0Âµm',
      Particles_10um: 'Particles â‰¥10Âµm'
    };

    async function fetchData() {
      try {
        const response = await fetch('http://localhost:3000/api/realtime');
        const data = await response.json();

        const tbody = document.querySelector('#data-table tbody');
        tbody.innerHTML = '';

        for (const key of Object.keys(unitMap)) {
          const row = document.createElement('tr');
          const cell1 = document.createElement('td');
          const cell2 = document.createElement('td');

          const displayName = nameMap[key] || key;
          const unit = unitMap[key] || '';

          cell1.textContent = displayName;
          cell2.textContent = (data[key] !== undefined) ? `${data[key]} ${unit}` : '-';

          row.appendChild(cell1);
          row.appendChild(cell2);
          tbody.appendChild(row);
        }

        // Show timestamp
        if (data.Timestamp) {
          const tsDiv = document.getElementById('timestamp');
          const date = new Date(data.Timestamp);
          tsDiv.textContent = 'Last Update: ' + date.toLocaleString();
        }

      } catch (error) {
        console.error('Error fetching data:', error);
      }
    }

    fetchData();
    setInterval(fetchData, 5000);
  </script>

</body>
</html>
